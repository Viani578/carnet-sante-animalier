<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attestation V√©t√©rinaire</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px solid #4a6fa5;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #e8f4fc;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #4a6fa5;
            font-size: 30px;
            color: #4a6fa5;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .cabinet-info {
            text-align: center;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .cabinet-info strong {
            color: #2c3e50;
        }
        
        .document-title {
            text-align: center;
            font-size: 22px;
            margin: 25px 0;
            padding: 10px;
            background-color: #f0f8ff;
            border-left: 4px solid #4a6fa5;
        }
        
        .two-columns {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        
        .form-column {
            flex: 1;
            min-width: 300px;
        }
        
        .preview-column {
            flex: 1;
            min-width: 300px;
        }
        
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 12px;
            gap: 10px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4a6fa5;
        }
        
        .checkbox-group {
            margin: 15px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 10px;
        }
        
        .signature-area {
            margin-top: 30px;
            text-align: center;
        }
        
        .signature-container {
            display: inline-block;
            margin: 0 auto;
            text-align: center;
        }
        
        .signature-canvas-container {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .signature-canvas {
            border: 1px solid #ddd;
            background-color: white;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
        }
        
        .signature-controls {
            margin-top: 10px;
            text-align: center;
        }
        
        .signature-controls button {
            margin: 0 5px;
            padding: 5px 10px;
            font-size: 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .stamp-controls {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .stamp-upload {
            margin-bottom: 15px;
        }
        
        .stamp-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }
        
        .stamp-small {
            width: 80px;
            height: 80px;
            border: 2px solid #a52a2a;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 10px;
            color: #a52a2a;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
            padding: 5px;
            background-color: white;
            margin-bottom: 10px;
        }
        
        .stamp-upload-btn {
            display: inline-block;
            padding: 8px 15px;
            background-color: #4a6fa5;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
        }
        
        .stamp-upload-btn:hover {
            background-color: #3a5a80;
        }
        
        #stamp-file {
            display: none;
        }
        
        .attestation-preview {
            padding: 25px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            height: fit-content;
            min-height: 800px;
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            overflow-y: auto;
            max-height: 800px;
        }
        
        .preview-content {
            line-height: 1.6;
            font-size: 14px;
        }
        
        .preview-content p {
            margin-bottom: 15px;
        }
        
        .preview-content ul {
            margin: 10px 0 20px 30px;
        }
        
        .signature-footer {
            margin-top: 40px;
            position: relative;
        }
        
        .signature-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 60px;
        }
        
        .signature-left {
            flex: 1;
            text-align: left;
            padding-right: 20px;
        }
        
        .signature-right {
            flex: 1;
            text-align: right;
            padding-left: 20px;
        }
        
        .stamp-center {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
            flex: 2;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-print {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-print:hover {
            background-color: #138496;
        }
        
        .info-note {
            background-color: #f8f9fa;
            padding: 10px;
            border-left: 3px solid #4a6fa5;
            margin: 15px 0;
            font-size: 13px;
            color: #666;
        }
        
        .attestation-item {
            margin: 12px 0 12px 20px;
        }
        
        @media print {
            @page {
                margin: 20mm;
            }
            
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            body * {
                visibility: hidden;
            }
            
            .attestation-preview,
            .attestation-preview * {
                visibility: visible;
            }
            
            .attestation-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 0;
                margin: 0;
                border: none;
                box-shadow: none;
            }
            
            .container,
            .form-column,
            .buttons,
            .info-note,
            .stamp-controls,
            .signature-controls,
            .header h2,
            .two-columns > .preview-column:first-child {
                display: none !important;
            }
            
            .two-columns {
                display: block;
            }
        }
        
        @media (max-width: 900px) {
            .two-columns {
                flex-direction: column;
            }
            
            .container {
                padding: 15px;
            }
            
            .signature-row {
                flex-direction: column;
                gap: 40px;
            }
            
            .signature-left,
            .signature-right {
                text-align: center;
                padding: 0;
            }
            
            .stamp-center {
                position: relative;
                bottom: auto;
                left: auto;
                transform: none;
                margin-top: 40px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-t√™te simplifi√© -->
        <div class="header">
            <div class="logo-container">
                <div class="logo" id="logo-click">
                    <span>üêæ</span>
                </div>
            </div>
            <h1>CABINET V√âT√âRINAIRE</h1>
            <div class="cabinet-info">
                <strong>Dr. <span id="vet-name-display">[Nom du v√©t√©rinaire]</span></strong><br>
                <span id="vet-address-display">[Adresse compl√®te]</span><br>
                T√©l√©phone : <span id="vet-phone-display">[Num√©ro]</span> | 
                Email : <span id="vet-email-display">[Adresse email]</span>
            </div>
        </div>
        
        <!-- Interface √† deux colonnes -->
        <div class="two-columns">
            <!-- Colonne gauche : Formulaire -->
            <div class="form-column">
                <form id="attestation-form" action="/attestation/generer" method="POST" enctype="multipart/form-data">
                    <div class="form-section">
                        <h3 class="section-title">Informations du v√©t√©rinaire</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vet-fullname">Nom et pr√©nom du v√©t√©rinaire *</label>
                                <input type="text" id="vet-fullname" name="vet-fullname" required>
                            </div>
                            <div class="form-group">
                                <label for="vet-registration">Num√©ro d'inscription √† l'Ordre *</label>
                                <input type="text" id="vet-registration" name="vet-registration" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vet-address">Adresse du cabinet *</label>
                                <input type="text" id="vet-address" name="vet-address" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vet-phone">T√©l√©phone *</label>
                                <input type="text" id="vet-phone" name="vet-phone" required>
                            </div>
                            <div class="form-group">
                                <label for="vet-email">Email *</label>
                                <input type="email" id="vet-email" name="vet-email" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">Informations de l'animal</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="animal-name">Nom de l'animal *</label>
                                <input type="text" id="animal-name" name="animal-name" required>
                            </div>
                            <div class="form-group">
                                <label for="animal-species">Esp√®ce *</label>
                                <select id="animal-species" name="animal-species" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="Chien">Chien</option>
                                    <option value="Chat">Chat</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="animal-breed">Race</label>
                                <input type="text" id="animal-breed" name="animal-breed">
                            </div>
                            <div class="form-group">
                                <label for="animal-gender">Sexe *</label>
                                <select id="animal-gender" name="animal-gender" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="M√¢le">M√¢le</option>
                                    <option value="Femelle">Femelle</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="animal-couleur">Couleur</label>
                                <input type="text" id="animal-couleur" name="animal-couleur" placeholder="Ex: 3 mois">
                            </div>
                            <div class="form-group">
                                <label for="animal-puce">Puc√© *</label>
                                <select id="animal-puce" name="animal-puce" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="Oui">Oui</option>
                                    <option value="Non">Non</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="owner-name">Propri√©taire de l'animal *</label>
                                <input type="text" id="owner-name" name="owner-name" required>
                            </div>
                            <div class="form-group">
                                <label for="animal-id">Identification (puce/tatouage) *</label>
                                <input type="text" id="animal-id" name="animal-id" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">Attestations</h3>
                        <div class="checkbox-group">
                            <p>Apr√®s examen clinique, j'atteste que l'animal est :</p>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation-health" name="attestation-health" checked>
                                <label for="attestation-health">En bonne sant√© g√©n√©rale</label>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation-vaccination" name="attestation-vaccination" checked>
                                <label for="attestation-vaccination">√Ä jour de ses vaccinations obligatoires</label>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation-disease" name="attestation-disease" checked>
                                <label for="attestation-disease">Ne pr√©sente aucun signe de maladie contagieuse au moment de l'examen</label>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="attestation-transport" name="attestation-transport" checked>
                                <label for="attestation-transport">Apte au transport auquel il est destin√©</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">Lieu et date</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">Ville o√π est √©tablie l'attestation *</label>
                                <input type="text" id="city" name="city" required>
                            </div>
                            <div class="form-group">
                                <label for="date">Date de l'attestation *</label>
                                <input type="date" id="date" name="date" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Zone de signature num√©rique -->
                    <div class="form-section">
                        <h3 class="section-title">Signature num√©rique</h3>
                        <div class="signature-area">
                            <div class="signature-canvas-container">
                                <canvas id="signature-canvas" class="signature-canvas" width="400" height="150"></canvas>
                            </div>
                            <div class="signature-controls">
                                <button type="button" id="clear-signature">Effacer</button>
                                <button type="button" id="save-signature">Enregistrer signature</button>
                            </div>
                        </div>
                        <!-- Champ cach√© pour la signature -->
                        <input type="hidden" id="signature-data" name="signature-data">
                    </div>
                    
                    <!-- T√©l√©chargement du cachet -->
                    <div class="stamp-controls">
                        <h3 class="section-title">Cachet du cabinet</h3>
                        <div class="stamp-upload">
                            <p>T√©l√©chargez une image de votre cachet (format PNG ou JPG, taille recommand√©e: 200x200px):</p>
                            <input type="file" id="stamp-file" name="stamp-file" accept="image/png, image/jpeg, image/jpg" style="display: none;">
                            <label for="stamp-file" class="stamp-upload-btn">Choisir un fichier</label>
                            <div class="stamp-preview">
                                <div class="stamp-small" id="stamp-preview-small">
                                    <div>Dr. [Nom]</div>
                                    <div>[Adresse]</div>
                                    <div>N¬∞[Inscription]</div>
                                </div>
                                <p>Pr√©visualisation du cachet (sera plac√© au centre entre la signature et la date)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bouton de soumission dans le formulaire -->
                    <div style="margin-top: 30px; text-align: center;">
                        <button type="submit" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 18px;">
                            T√©l√©charger l'attestation au format PDF
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Colonne droite : Pr√©visualisation -->
            <div class="preview-column">
                <h2 class="section-title" style="text-align: center; margin-bottom: 15px;">Pr√©visualisation</h2>
                <div class="attestation-preview" id="attestation-preview">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="buttons">
            <button type="button" class="btn btn-secondary" id="reset-btn">Effacer le formulaire</button>
            <button type="button" class="btn btn-print" id="print-btn">Imprimer l'attestation</button>
        </div>
        
        <!-- Note informative -->
        <div class="info-note">
            <p><strong>Instructions :</strong> Remplissez tous les champs obligatoires (*). Signez dans la zone de signature ci-dessus. T√©l√©chargez votre cachet si vous en avez un. La pr√©visualisation se met √† jour automatiquement. Cliquez sur "T√©l√©charger l'attestation au format PDF" pour g√©n√©rer et t√©l√©charger le document officiel.</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // √âl√©ments du formulaire
            const form = document.getElementById('attestation-form');
            const resetBtn = document.getElementById('reset-btn');
            const printBtn = document.getElementById('print-btn');
            const previewContainer = document.getElementById('attestation-preview');
            
            // √âl√©ments de signature
            const signatureCanvas = document.getElementById('signature-canvas');
            const clearSignatureBtn = document.getElementById('clear-signature');
            const saveSignatureBtn = document.getElementById('save-signature');
            const signatureDataInput = document.getElementById('signature-data');
            const ctx = signatureCanvas.getContext('2d');
            
            // Variables pour la signature
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let signatureData = null;
            
            // √âl√©ment pour le cachet
            const stampFileInput = document.getElementById('stamp-file');
            const stampPreviewSmall = document.getElementById('stamp-preview-small');
            let stampImage = null;
            
            // Initialiser le canvas de signature
            function initSignatureCanvas() {
                // R√©initialiser le canvas
                ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                
                // √âv√©nements pour dessiner
                signatureCanvas.addEventListener('mousedown', startDrawing);
                signatureCanvas.addEventListener('mousemove', draw);
                signatureCanvas.addEventListener('mouseup', stopDrawing);
                signatureCanvas.addEventListener('mouseout', stopDrawing);
                
                // Pour les appareils tactiles
                signatureCanvas.addEventListener('touchstart', handleTouchStart);
                signatureCanvas.addEventListener('touchmove', handleTouchMove);
                signatureCanvas.addEventListener('touchend', stopDrawing);
            }
            
            // Gestion de la signature - souris
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getCoordinates(e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                
                const [x, y] = getCoordinates(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Gestion de la signature - tactile
            function handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                signatureCanvas.dispatchEvent(mouseEvent);
            }
            
            function handleTouchMove(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                signatureCanvas.dispatchEvent(mouseEvent);
            }
            
            // Obtenir les coordonn√©es
            function getCoordinates(e) {
                const rect = signatureCanvas.getBoundingClientRect();
                let x, y;
                
                if (e.type.includes('mouse')) {
                    x = e.clientX - rect.left;
                    y = e.clientY - rect.top;
                } else {
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                }
                
                return [x, y];
            }
            
            // Effacer la signature
            clearSignatureBtn.addEventListener('click', function() {
                initSignatureCanvas();
                signatureData = null;
                signatureDataInput.value = '';
                updatePreview();
            });
            
            // Enregistrer la signature
            saveSignatureBtn.addEventListener('click', function() {
                signatureData = signatureCanvas.toDataURL('image/png');
                signatureDataInput.value = signatureData;
                alert('Signature enregistr√©e avec succ√®s!');
                updatePreview();
            });
            
            // Gestion du t√©l√©chargement du cachet
            stampFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        stampImage = new Image();
                        stampImage.src = event.target.result;
                        stampImage.onload = function() {
                            // Mettre √† jour la pr√©visualisation du cachet
                            stampPreviewSmall.innerHTML = '';
                            const img = document.createElement('img');
                            img.src = stampImage.src;
                            img.style.width = '100%';
                            img.style.height = '100%';
                            img.style.borderRadius = '50%';
                            stampPreviewSmall.appendChild(img);
                            updatePreview();
                        };
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Clic sur le logo pour t√©l√©charger un cachet
            document.getElementById('logo-click').addEventListener('click', function() {
                stampFileInput.click();
            });
            
            // Fonction pour formater la date en fran√ßais
            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return date.toLocaleDateString('fr-FR', options);
            }
            
            // Fonction pour g√©n√©rer la pr√©visualisation
            function generatePreview() {
                // R√©cup√©rer les valeurs du formulaire
                const vetFullname = document.getElementById('vet-fullname').value || '[Nom et pr√©nom]';
                const vetRegistration = document.getElementById('vet-registration').value || '[Num√©ro d\'inscription]';
                const animalName = document.getElementById('animal-name').value || '[Nom]';
                const animalSpecies = document.getElementById('animal-species').value || '[Chien / Chat / Autre]';
                const animalBreed = document.getElementById('animal-breed').value || '[Race]';
                const animalGender = document.getElementById('animal-gender').value || '[M√¢le/Femelle]';
                const animalPuce = document.getElementById('animal-puce').value || '[Oui/Non]';
                const animalCouleur = document.getElementById('animal-couleur').value || '[Couleur]';
                const ownerName = document.getElementById('owner-name').value || '[Nom et pr√©nom du propri√©taire]';
                const animalId = document.getElementById('animal-id').value || '[Num√©ro de puce √©lectronique ou tatouage]';
                const city = document.getElementById('city').value || '[Ville]';
                const date = document.getElementById('date').value;
                
                // V√©rifier les attestations
                const healthChecked = document.getElementById('attestation-health').checked;
                const vaccinationChecked = document.getElementById('attestation-vaccination').checked;
                const diseaseChecked = document.getElementById('attestation-disease').checked;
                const transportChecked = document.getElementById('attestation-transport').checked;
                
                // Mettre √† jour l'en-t√™te
                document.getElementById('vet-name-display').textContent = vetFullname.split(' ').pop() || '[Nom du v√©t√©rinaire]';
                document.getElementById('vet-address-display').textContent = document.getElementById('vet-address').value || '[Adresse compl√®te]';
                document.getElementById('vet-phone-display').textContent = document.getElementById('vet-phone').value || '[Num√©ro]';
                document.getElementById('vet-email-display').textContent = document.getElementById('vet-email').value || '[Adresse email]';
                
                // G√©n√©rer le contenu de la pr√©visualisation
                let previewHTML = `
                    <div class="preview-content">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h2 style="font-size: 22px; margin-bottom: 20px; color: #2c3e50;">ATTESTATION V√âT√âRINAIRE</h2>
                        </div>
                        
                        <p>Je soussign√©(e), Dr. <strong>${vetFullname}</strong>, v√©t√©rinaire inscrit(e) √† l'Ordre National des V√©t√©rinaires sous le num√©ro <strong>${vetRegistration}</strong>, certifie avoir examin√© ce jour l'animal ci-apr√®s :</p>
                        
                        <div style="margin: 20px 0 20px 30px;">
                            <div class="attestation-item"><strong>Nom de l'animal :</strong> ${animalName}</div>
                            <div class="attestation-item"><strong>Esp√®ce :</strong> ${animalSpecies}</div>
                            <div class="attestation-item"><strong>Race :</strong> ${animalBreed}</div>
                            <div class="attestation-item"><strong>Sexe :</strong> ${animalGender}</div>
                            <div class="attestation-item"><strong>Couleur :</strong> ${animalCouleur}</div>
                            <div class="attestation-item"><strong>Puc√© :</strong> ${animalPuce}</div>
                            <div class="attestation-item"><strong>Propri√©taire de l'animal :</strong> ${ownerName}</div>
                            <div class="attestation-item"><strong>Identification :</strong> ${animalId}</div>
                        </div>
                        
                        <p>Apr√®s examen clinique, j'atteste que l'animal est :</p>
                        <ul style="margin: 10px 0 20px 40px;">
                            <li style="${healthChecked ? '' : 'text-decoration: line-through; color: #999;'}">En bonne sant√© g√©n√©rale</li>
                            <li style="${vaccinationChecked ? '' : 'text-decoration: line-through; color: #999;'}">√Ä jour de ses vaccinations obligatoires</li>
                            <li style="${diseaseChecked ? '' : 'text-decoration: line-through; color: #999;'}">Ne pr√©sente aucun signe de maladie contagieuse au moment de l'examen</li>
                            <li style="${transportChecked ? '' : 'text-decoration: line-through; color: #999;'}">Apte au transport auquel il est destin√©</li>
                        </ul>
                        
                        <p>Fait pour servir et valoir ce que de droit.</p>
                        
                        <div class="signature-footer">
                            <div class="signature-row">
                                <!-- DATE √Ä GAUCHE -->
                                <div class="signature-left">
                                    <div style="margin-top: 40px;">
                                        <div style="font-weight: bold; margin-bottom: 15px;">
                                            Fait √† <strong>${city}</strong>, le <strong>${formatDate(date) || '[Date]'}</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- SIGNATURE √Ä DROITE -->
                                <div class="signature-right">
                                    <div style="margin-top: 40px; text-align: right;">
                                        <div style="font-style: italic; color: #666;">
                                            Signature du v√©t√©rinaire
                                        </div>
                                        ${signatureData ? `<img src="${signatureData}" style="max-width: 200px; max-height: 80px; display: block; margin: 0 auto 10px;" alt="Signature" />` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            ${stampImage ? `
                                <div class="stamp-center">
                                    <img src="${stampImage.src}" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #a52a2a;" alt="Cachet" />
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                previewContainer.innerHTML = previewHTML;
                return previewContainer;
            }
            
            // Fonction pour mettre √† jour la pr√©visualisation en temps r√©el
            function updatePreview() {
                generatePreview();
            }
            
            // √âv√©nement pour r√©initialiser le formulaire
            resetBtn.addEventListener('click', function() {
                if (confirm('Voulez-vous vraiment effacer tous les champs du formulaire?')) {
                    form.reset();
                    initSignatureCanvas();
                    signatureData = null;
                    signatureDataInput.value = '';
                    stampImage = null;
                    stampFileInput.value = '';
                    stampPreviewSmall.innerHTML = `
                        <div>Dr. [Nom]</div>
                        <div>[Adresse]</div>
                        <div>N¬∞[Inscription]</div>
                    `;
                    
                    // R√©initialiser l'en-t√™te
                    document.getElementById('vet-name-display').textContent = '[Nom du v√©t√©rinaire]';
                    document.getElementById('vet-address-display').textContent = '[Adresse compl√®te]';
                    document.getElementById('vet-phone-display').textContent = '[Num√©ro]';
                    document.getElementById('vet-email-display').textContent = '[Adresse email]';
                    
                    // R√©initialiser la pr√©visualisation
                    previewContainer.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">La pr√©visualisation appara√Ætra ici au fur et √† mesure de la saisie</p>';
                    
                    // Pr√©-remplir la date d'aujourd'hui
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('date').value = today;
                    
                    // D√©clencher la premi√®re mise √† jour
                    setTimeout(updatePreview, 100);
                }
            });
            
            // √âv√©nement pour imprimer
            printBtn.addEventListener('click', function() {
                // V√©rifier que l'attestation a √©t√© g√©n√©r√©e
                const vetName = document.getElementById('vet-fullname').value;
                if (!vetName || vetName === '[Nom et pr√©nom]') {
                    alert('Veuillez d\'abord remplir les informations avant d\'imprimer.');
                    return;
                }
                
                // Mettre √† jour la pr√©visualisation
                updatePreview();
                
                // Attendre un peu pour que le DOM se mette √† jour
                setTimeout(() => {
                    window.print();
                }, 500);
            });
            
            // Validation du formulaire avant soumission
            form.addEventListener('submit', function(e) {
                // V√©rifier les champs obligatoires
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.style.borderColor = '#dc3545';
                        isValid = false;
                    } else {
                        field.style.borderColor = '#ddd';
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                    alert('Veuillez remplir tous les champs obligatoires (*)');
                    return false;
                }
                
                // V√©rifier la signature
                if (!signatureDataInput.value) {
                    e.preventDefault();
                    if (!confirm('Vous n\'avez pas enregistr√© de signature. Souhaitez-vous continuer sans signature?')) {
                        return false;
                    }
                }
                
                // Afficher un message de chargement
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'G√©n√©ration du PDF en cours...';
                
                // R√©activer le bouton apr√®s 5 secondes (au cas o√π)
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }, 5000);
                
                return true;
            });
            
            // √âcouteurs d'√©v√©nements pour la mise √† jour en temps r√©el
            const updateFields = [
                'vet-fullname', 'vet-registration', 'vet-address', 'vet-phone', 'vet-email',
                'animal-name', 'animal-species', 'animal-breed', 'animal-gender', 
                'animal-age', 'animal-birthdate', 'owner-name', 'animal-id',
                'city', 'date'
            ];
            
            updateFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updatePreview);
                    field.addEventListener('change', updatePreview);
                }
            });
            
            // √âcouteurs pour les checkbox
            const checkboxes = ['attestation-health', 'attestation-vaccination', 'attestation-disease', 'attestation-transport'];
            checkboxes.forEach(checkboxId => {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox) {
                    checkbox.addEventListener('change', updatePreview);
                }
            });
            
            // Pr√©-remplir la date d'aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // Initialiser le canvas de signature
            initSignatureCanvas();
            
            // Message initial dans la pr√©visualisation
            previewContainer.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">La pr√©visualisation appara√Ætra ici au fur et √† mesure de la saisie</p>';
            
            // D√©clencher la premi√®re mise √† jour
            setTimeout(updatePreview, 100);
        });
    </script>
</body>
</html>